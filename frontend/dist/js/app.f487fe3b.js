(()=>{"use strict";var e={341:(e,t,s)=>{var o=s(751),n=s(641);const r={id:"app",class:"bg-background h-screen flex text-text"},a={key:0,class:"w-full h-full flex items-center justify-center"},i={key:1,class:"w-full h-full flex"},l={class:"flex-grow flex flex-col px-4"},c={class:"flex-grow flex flex-col"};function d(e,t,s,o,d,u){const g=(0,n.g2)("Sidebar"),p=(0,n.g2)("Topbar"),h=(0,n.g2)("ChatWindow"),f=(0,n.g2)("MessageInput");return(0,n.uX)(),(0,n.CE)("div",r,[d.isAuthenticated?((0,n.uX)(),(0,n.CE)("div",i,[(0,n.bF)(g),(0,n.Lk)("div",l,[(0,n.bF)(p,{user:d.user,onLogout:u.logout},null,8,["user","onLogout"]),(0,n.Lk)("div",c,[(0,n.bF)(h,{messages:d.messages,class:"w-full max-w-2xl flex-grow"},null,8,["messages"]),(0,n.bF)(f,{onSendMessage:u.sendMessage,class:"w-full max-w-2xl mt-4"},null,8,["onSendMessage"])])])])):((0,n.uX)(),(0,n.CE)("div",a,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>u.login&&u.login(...e)),class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"}," Login ")]))])}var u=s(33);const g={class:"chat-window bg-secondary p-4 rounded-lg shadow-md overflow-y-auto h-96"},p={class:"font-bold block text-sm opacity-80"},h={class:"block text-base"};function f(e,t,s,o,r,a){return(0,n.uX)(),(0,n.CE)("div",g,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.messages,(e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:e.message_id||t,class:(0,u.C4)(["message mb-3 p-3 rounded-lg max-w-[80%]",{"bg-primary text-white ml-auto":"user1"===e.user_id,"bg-accent text-white":"user1"!==e.user_id}])},[(0,n.Lk)("span",p,(0,u.v_)(e.user_id)+":",1),(0,n.Lk)("span",h,(0,u.v_)(e.content),1)],2))),128))])}const w={name:"ChatWindow",props:{messages:{type:Array,required:!0}},updated(){console.log("ChatWindow component updated with new messages:",this.messages);const e=this.$el;e.scrollTop=e.scrollHeight}};var m=s(262);const b=(0,m.A)(w,[["render",f],["__scopeId","data-v-048771b6"]]),k=b,v={class:"message-input flex p-4 bg-secondary rounded-lg shadow-md mt-4"};function y(e,t,s,r,a,i){return(0,n.uX)(),(0,n.CE)("div",v,[(0,n.bo)((0,n.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.message=e),onKeyup:t[1]||(t[1]=(0,o.jR)((...e)=>i.send&&i.send(...e),["enter"])),placeholder:"Type a message...",class:"flex-grow p-3 rounded-l-lg border-none focus:ring-2 focus:ring-primary outline-none bg-background text-text"},null,544),[[o.Jo,a.message]]),(0,n.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>i.send&&i.send(...e)),class:"bg-primary hover:opacity-90 text-white font-bold py-3 px-6 rounded-r-lg border border-primary transition-opacity duration-200 ml-2"}," Send ")])}const x={name:"MessageInput",data(){return{message:""}},methods:{send(){""!==this.message.trim()&&(console.log("Sending message from MessageInput:",this.message),this.$emit("send-message",this.message),this.message="")}}},_=(0,m.A)(x,[["render",y],["__scopeId","data-v-772b3ea0"]]),E=_,S={class:"w-1/4 bg-dark-purple p-4 shadow-md flex flex-col text-white"};function I(e,t,s,o,r,a){return(0,n.uX)(),(0,n.CE)("div",S,[...t[0]||(t[0]=[(0,n.Lk)("h2",{class:"text-xl font-bold mb-4"},"Sidebar",-1),(0,n.Lk)("ul",{class:"space-y-2"},[(0,n.Lk)("li",null,"Item 1"),(0,n.Lk)("li",null,"Item 2"),(0,n.Lk)("li",null,"Item 3")],-1)])])}const C={name:"Sidebar"},A=(0,m.A)(C,[["render",I],["__scopeId","data-v-4492e883"]]),T=A,L={class:"w-full bg-dark-purple p-4 flex justify-end items-center shadow-md text-white"},R={key:0},O={class:"mr-4"};function U(e,t,s,o,r,a){return(0,n.uX)(),(0,n.CE)("div",L,[s.user?((0,n.uX)(),(0,n.CE)("div",R,[(0,n.Lk)("span",O,"Welcome, "+(0,u.v_)(s.user.profile.name),1),(0,n.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("logout")),class:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"}," Logout ")])):(0,n.Q3)("",!0)])}const X={name:"Topbar",props:{user:{type:Object,default:null}}},W=(0,m.A)(X,[["render",U],["__scopeId","data-v-598fbc0b"]]),j=W;var M=s(405);const $={authority:(void 0).VITE_DEX_ISSUER_URL,client_id:(void 0).VITE_DEX_CLIENT_ID,redirect_uri:(void 0).VITE_DEX_REDIRECT_URI,response_type:"code",scope:(void 0).VITE_DEX_SCOPES,post_logout_redirect_uri:(void 0).VITE_DEX_REDIRECT_URI,userStore:new M.WebStorageStateStore({store:window.localStorage})},P=new M.UserManager($),V={userManager:P,async login(){return P.signinRedirect()},async logout(){return P.signoutRedirect()},async handleAuthentication(){return P.signinRedirectCallback()},async getUser(){return P.getUser()},async getAccessToken(){const e=await P.getUser();if(!e)return null;if(e.expired&&e.refresh_token)try{const e=await P.signinSilent();return e.access_token}catch(t){throw await P.signoutRedirect(),new Error("Session expired. Please log in again.")}return e.access_token},async getMessages(){const e=await this.getAccessToken();if(!e)throw new Error("User not authenticated");const t=await fetch(`${(void 0).VITE_API_BASE_URL}/messages`,{headers:{Authorization:`Bearer ${e}`}});if(401===t.status)throw await P.signoutRedirect(),new Error("Session expired. Please log in again.");if(!t.ok)throw new Error("Failed to fetch messages");return t.json()},async sendMessage(e){const t=await this.getAccessToken();if(!t)throw new Error("User not authenticated");const s=await fetch(`${(void 0).VITE_API_BASE_URL}/messages`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(401===s.status)throw await P.signoutRedirect(),new Error("Session expired. Please log in again.");if(!s.ok)throw new Error("Failed to send message");return s.json()},async connectWebSocket(e){const t=await this.getAccessToken();if(!t)throw new Error("User not authenticated");const s=new WebSocket(`${(void 0).VITE_WS_URL}?token=${t}`);return s.onopen=()=>{console.log("WebSocket connection established.")},s.onmessage=t=>{e(JSON.parse(t.data))},s.onerror=e=>{console.error("WebSocket error:",e)},s.onclose=e=>{e.wasClean?console.log(`WebSocket connection closed cleanly, code=${e.code} reason=${e.reason}`):console.error("WebSocket connection died")},s}},D={name:"App",components:{ChatWindow:k,MessageInput:E,Sidebar:T,Topbar:j},data(){return{messages:[],socket:null,user:null,isAuthenticated:!1}},methods:{sendMessage(e){const t={user_id:this.user.profile.name,content:e};this.socket.send(JSON.stringify(t))},login(){V.login()},logout(){V.logout()},async initializeApp(){const e=await V.getUser();if(this.user=e,this.isAuthenticated=!!e,this.isAuthenticated){this.socket=await V.connectWebSocket(e=>{this.messages.push(e)});const e=await V.getMessages();this.messages=e}}},async created(){"/callback"===window.location.pathname&&(await V.handleAuthentication(),window.history.replaceState({},document.title,"/")),this.initializeApp()}},F=(0,m.A)(D,[["render",d]]),z=F;(0,o.Ef)(z).mount("#app")}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,s),r.exports}s.m=e,(()=>{var e=[];s.O=(t,o,n,r)=>{if(!o){var a=1/0;for(d=0;d<e.length;d++){for(var[o,n,r]=e[d],i=!0,l=0;l<o.length;l++)(!1&r||a>=r)&&Object.keys(s.O).every(e=>s.O[e](o[l]))?o.splice(l--,1):(i=!1,r<a&&(a=r));if(i){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,n,r]}})(),(()=>{s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={524:0};s.O.j=t=>0===e[t];var t=(t,o)=>{var n,r,[a,i,l]=o,c=0;if(a.some(t=>0!==e[t])){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(l)var d=l(s)}for(t&&t(o);c<a.length;c++)r=a[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=s.O(void 0,[504],()=>s(341));o=s.O(o)})();
//# sourceMappingURL=app.f487fe3b.js.map